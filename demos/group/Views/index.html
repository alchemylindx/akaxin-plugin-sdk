<!DOCTYPE html>
<html>

<head>
    <title>好友匹配</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/1.1.2/weui.min.css" />
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet"  href="https://cdn.jsdelivr.net/npm/animate.css@3.5.2/animate.min.css">
    <link rel="stylesheet" href="<?php echo $http_domain;?>/Public/css/zaly.css?<?php echo $suffix;?>" />
</head>

<body ontouchstart="">

<div id="container" class="row friend_match_div" style="width:100%; height:100%;margin:0px auto;position:relative; ">
    <div class="position_absolute">
        <div style="width:100%; height:100%; margin:0px auto;position:relative; margin-top: 0; ">
            <div style="width:100%; height:80%; margin:15px auto; margin-top: 0; " >
                <div class="like_first" >
                </div>
                <div class="like_second" >
                </div>
                <div class="content_div">
                    <div class="like_height group_info " style="display: none" id="no_group">
                        <div class=" center-block position_absolute" >
                            <div class=" position_absolute  ">
                                <img class="group_icon img-thumbnail " style=" margin-top:20%; height: 50%;width: 50%; overflow: hidden;" src="<?php echo $http_domain;?>/Public/img/no_group.png">
                            </div>
                        </div>
                        <div  class=" position_absolute like_group_name "  style="top: 70%; font-size: 16px;">
                            还没有推荐的群组
                        </div>
                        <div  class=" position_absolute like_group_desc"  style="top: 80%;">
                            (ಥ_ಥ)
                        </div>
                        <div class="position_absolute like_user_info_div " >
                            <div class="col-xs-5 col-sm-* ">
                                <div class=" center-block position_absolute like_user_hometown ">
                                    <br/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <input type="hidden" class="group_list_info" group-list='<?php echo json_encode($group_list, true);?>'>
                <input type="hidden" class="config_name" data="<?php echo $config_name;?>">

            </div>
            <div class="like_or_no_like" style="width:100%; margin:0px auto;position:relative; margin-top: 0; "  >
                <div class="col-xs-6 col-sm-* next_group "  url-data="/index.php">
                    <button class="bubbly-next-button" style="font-size: 12px;">给朕换下一个</button>
                </div>
                <div class="col-xs-6 col-sm-* join_group "   url-data="/index.php?page_type=join_group">
                    <button class="bubbly-button"  style="font-size: 12px;">加入群聊!</button>
                </div>
            </div>

        </div>

    </div>
    <div class="position_absolute guide_div"  id="guide_div" style="text-align: center;vertical-align:middle; ">
        <div id="guide_right" class="animated" style=" transform: translate(-50%,-50%); position: absolute; top: 40%; left:30%; overflow: hidden; width:150px;display:none;">
            <img style="width: 150px;" src="<?php echo $http_domain;?>/Public/img/right.png">
            <p style="font-size: 12px;color: #ff0081;">对我感兴趣，右滑加入我啊<br/>(｡･ω･｡)ﾉ♡</p>
        </div>
        <div id="guide_left" class="animated" style=" transform: translate(-50%,-50%); position: absolute; top: 40%; right:5%;overflow: hidden; width:100px; display:none;" >
            <img style=" width:100px;" src="<?php echo $http_domain;?>/Public/img/left.png">
            <p style="font-size: 12px;color: #ff0081;">左滑，给朕换一个<br/>ｸﾞｯ!(๑•̀ㅂ•́)و✧</p>
        </div>

    </div>
</div>

<script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.2.4/jquery.js"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/libs/weuijs/1.1.3/weui.min.js"></script>
<script type="text/javascript" src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.js"></script>
<script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" src="<?php echo $http_domain;?>/Public/js/zaly.js" ></script>
<script type="text/javascript" src="<?php echo $http_domain;?>/Public/js/fountain.js" ></script>

<script type="text/javascript">
    page = 1;
    groupIndex = 1;
    $(document).on("click", ".join_group", function() {
        joinGroup();
    });
    setTimeout(function(){
        document.getElementById("guide_right").style.display="block";
    }, 500);


    setTimeout(function(){
        $("#guide_right").addClass("fadeOutRight");
    }, 1500);

    setTimeout(function(){
        document.getElementById("guide_left").style.display="block";
    }, 2000);

    setTimeout(function(){
        $("#guide_left").addClass("fadeOutLeft");
    }, 3000);

    setTimeout(function(){
        document.getElementById("guide_div").remove();
    }, 3500);

    function joinGroup() {
        var groupId = $('.join_group').attr("site-group-id");
        var configName = $(".config_name").attr('data');
        $.ajax({
            method: "POST",
            url:"<?php echo $http_domain;?>/index.php",
            data: {
                page_type: "join_group",
                config_name:configName,
                group_id:groupId
            },
            success:function (data) {
                console.log(data);
                if(data == "success") {
                    nextGroupInfo();
                } else {
                    Zaly.tip(data);
                }
            }
        });
    }

    var groupListJsonStr = $(".group_list_info").attr("group-list");
    var groupListArr = JSON.parse(groupListJsonStr);

    $(document).on("click", ".next_group ", function () {
        nextGroupInfo();
    });

    function nextGroupInfo() {
        var groupInfo  = groupListArr.shift();
        var configName = $(".config_name").attr('data');
        if(groupInfo) {
            addGroupInfo(groupInfo);
        } else {
            console.log("console log ");
            page = page+1;
            $.ajax({
                method: "POST",
                url:"<?php echo $http_domain;?>/index.php",
                data: {
                    page_type: "next_list",
                    config_name:configName,
                    page_num : page,
                },
                success:function (data) {
                    groupListJsonStr = data;
                    groupListArr = JSON.parse(groupListJsonStr);
                    groupInfo = groupListArr.shift();
                    if(!groupInfo) {
                        page = 0;
                        nextGroupInfo();
                    }
                    addGroupInfo(groupInfo);
                }
            });
        }
    }
    function addGroupInfo(group) {
        if(group) {
            $('.user_info').addClass('fadeOutLeft');
            $('.join_group').attr("site-group-id", group.group_id);
            html = '<div class="like_height group_info animated  fadeInRight" site-group-id="'+group.group_id+'" > <div class=" center-block position_absolute" > <div class=" position_absolute  "> <img class="group_icon img-thumbnail '+ group.group_icon+' " site-group-logo="'+ group.group_icon+'" style=" margin-top:20%; height: 50%;width: 40%; overflow: hidden;"> </div> </div> <div  class=" position_absolute like_group_name"  style="top: 70%;"> '+ group.group_name +'</div> <div  class=" position_absolute like_group_desc"  style="top: 80%;"> '+group.group_notice+' </div> <div class="position_absolute like_user_info_div " > <div class="col-xs-5 col-sm-* "> <div class=" center-block position_absolute like_user_hometown "> <label style="margin-top:10px"><br/></label> <br/> </div> </div> </div> </div>'
            $('.content_div').html(html);
            Zaly.reqImageDownload(group.group_icon, "jsimageDownload");
            $('.group_info').addClass('fadeInRight');
        }
    }

    $(document).ready(function(){
        var groupInfo  = groupListArr.shift();
        if(groupInfo) {
            addGroupInfo(groupInfo);
        } else {
            document.getElementById("no_group").style.display="block";
        }
    });

    function jsimageDownload(result, imageid, imageLocalPath) {
        var type = Zaly.getOsType();
        console.log(imageLocalPath);
        if (type == 'Android') {
            imageLocalPath = 'http://akaxin/img' + imageLocalPath;
        }
        $('.'+imageid).attr("src", imageLocalPath);
    }



    function goonNext(){
        $('.is_friend_bg').addClass('zoomOut');
        $('.is_friend_bg').addClass('hidden');
        $('.friend_match_div').removeClass('mark');
        page = page+1;
        reqNextUserInfo();
    }

    var animateButton = function(e) {

        e.preventDefault;
        //reset animation
        e.target.classList.remove('animate');

        e.target.classList.add('animate');
        setTimeout(function(){
            e.target.classList.remove('animate');
        },700);
    };

    var bubblyButtons = document.getElementsByClassName("bubbly-button");

    for (var i = 0; i < bubblyButtons.length; i++) {
        bubblyButtons[i].addEventListener('click', animateButton, false);
    }

    $(".content_div").on("touchstart", function(e) {
        e.preventDefault();
        startX = e.originalEvent.changedTouches[0].pageX,
            startY = e.originalEvent.changedTouches[0].pageY;
    });
    $(".content_div").on("touchmove", function(e) {
        e.preventDefault();
        moveEndX = e.originalEvent.changedTouches[0].pageX,
            moveEndY = e.originalEvent.changedTouches[0].pageY,
            X = moveEndX - startX,
            Y = moveEndY - startY;

        if ( Math.abs(X) > Math.abs(Y) && X > 0 ) {
            console.log("to right");
            ////右滑喜欢
            joinGroup();
        }
        else if ( Math.abs(X) > Math.abs(Y) && X < 0 ) {
            // console.log("to left");
            ////左滑不喜欢
            nextGroupInfo();
        }
    });


</script>
</body>

</html>